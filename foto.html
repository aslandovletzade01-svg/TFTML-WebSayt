<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFTML Foto-Stend</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f0f4f8; padding: 20px; margin: 0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        video { width: 100%; border-radius: 15px; background: #2c3e50; transform: scaleX(-1); }
        canvas { display: none; }
        .btn { padding: 15px 25px; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; margin: 10px; font-size: 14px; transition: 0.3s; }
        .snap-btn { background: #e74c3c; color: white; }
        .save-btn { background: #27ae60; color: white; display: none; text-decoration: none; }
        .send-btn { background: #3498db; color: white; display: none; }
        .back-btn { background: #95a5a6; color: white; text-decoration: none; display: inline-block; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“¸ XatirÉ™ Foto-Stendi</h2>
    <p id="status" style="color: #7f8c8d;">Kameraya baxÄ±n vÉ™ ÅŸÉ™kli Ã§É™kin</p>
    
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" width="640" height="480"></canvas>

    <div style="margin-top: 20px;">
        <button id="snap" class="btn snap-btn">ğŸ“¸ ÅÉ™kli Ã‡É™k</button>
        <a id="download_link" download="TFTML_Xatire.png" class="btn save-btn">ğŸ“¥ Yadda Saxla</a>
        <button id="send_btn" class="btn send-btn">âœ‰ï¸ MÉ™ktÉ™bÉ™ GÃ¶ndÉ™r</button>
    </div>
    
    <div style="margin-top: 20px;">
        <a href="index.html" class="btn back-btn">â† Geri QayÄ±t</a>
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const snap = document.getElementById('snap');
    const downloadLink = document.getElementById('download_link');
    const sendBtn = document.getElementById('send_btn');
    const statusText = document.getElementById('status');
    const context = canvas.getContext('2d');

    navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
        .then(stream => { video.srcObject = stream; })
        .catch(err => { alert("Kamera icazÉ™si lazÄ±mdÄ±r!"); });

    snap.addEventListener('click', () => {
        context.translate(640, 0);
        context.scale(-1, 1);
        context.drawImage(video, 0, 0, 640, 480);
        context.setTransform(1, 0, 0, 1, 0, 0);

        const logo = new Image();
        logo.src = 'logo.jpg'; 
        logo.onload = () => {
            context.drawImage(logo, 530, 370, 90, 90);
            context.fillStyle = "white";
            context.font = "bold 20px Arial";
            context.fillText("TFTML 2026 XatirÉ™si", 30, 450);

            downloadLink.href = canvas.toDataURL('image/png');
            downloadLink.style.display = 'inline-block';
            sendBtn.style.display = 'inline-block';
            statusText.innerText = "ÅÉ™kil hazÄ±rdÄ±r! Yadda saxlaya vÉ™ ya bizÉ™ gÃ¶ndÉ™rÉ™ bilÉ™rsiniz.";
        };
    });

    sendBtn.addEventListener('click', async () => {
        const imageData = canvas.toDataURL('image/png');
        statusText.innerText = "GÃ¶ndÉ™rilir... GÃ¶zlÉ™yin.";
        
        // DÄ°QQÆT: AÅŸaÄŸÄ±dakÄ± linki Ã¶z Formspree linkinlÉ™ É™vÉ™z et!
        const formspreeLink = "https://formspree.io/f/xykdzypw"; 

        try {
            const response = await fetch(formspreeLink, {
                method: 'POST',
                headers: { 'Accept': 'application/json' },
                body: JSON.stringify({
                    message: "Yeni xatirÉ™ ÅŸÉ™kli gÃ¶ndÉ™rildi!",
                    image: imageData
                })
            });

            if (response.ok) {
                statusText.innerText = "âœ… ÅÉ™kil uÄŸurla Gmail-É™ gÃ¶ndÉ™rildi!";
                sendBtn.style.display = 'none';
            } else {
                statusText.innerText = "âŒ XÉ™ta baÅŸ verdi. YenidÉ™n yoxlayÄ±n.";
            }
        } catch (error) {
            statusText.innerText = "âŒ Ä°nternet baÄŸlantÄ±sÄ±nÄ± yoxlayÄ±n.";
        }
    });
</script>

</body>
</html>
